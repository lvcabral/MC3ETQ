*************************************************
* NOME.....: !CALEND.PRG                        *
* FUNCAO...: CALENDARIO()                       *
* AUTOR....: MARCELO LEAL LIMAVERDE CABRAL      *
* SINTAXE..: CALENDARIO(x,y,[<data>],[<cor>])   *
* DESCRI€AO: EXPLODE UM CALENDARIO NA TELA.     *
*************************************************
FUNCTION CALENDARIO
PARAM LIN,COL,DATAPARM,CORAUX

LOCAL LINX,COLX,DATACON,DATAHOJE,MES,TECLA,TELA,SEM,AJU,COR,;
      CPOSI,CNORM,CFINA,CINVE

TELA=SAVESCREEN(LIN,COL,LIN+10,COL+31)
COR =SETCOLOR()

IF TYPE("LIN")#"N"
   LIN=0
ENDIF

IF TYPE("COL")#"N"
   COL=0
ENDIF

DO CASE
CASE TYPE("DATAPARM")="C"
     DATAPARM=CTOD(DATAPARM)
CASE TYPE("DATAPARM")="D"
OTHER
     DATAPARM=DATE()
ENDCASE

IF TYPE("CORAUX")="C"
   SETCOLOR(CORAUX)
ENDIF

CNORM=SETCOLOR()
CPOSI=AT(",",CNORM)+1
CFINA=AT(",",SUBSTR(CNORM,CPOSI+1))
CINVE=SUBSTR(CNORM,CPOSI,CFINA)

DATAHOJE=DATAPARM
HOR=TIME()
Explode(LIN,COL,LIN+9,COL+30,3)
DO WHILE .T.
   Janela(LIN,COL,LIN+9,COL+30)
   BoxShadow(LIN,COL,LIN+9,COL+30)
   SETCOLOR(CINVE)
   SEM=" DOM SEG TER QUA QUI SEX SAB "
   AJU=" "+CHR(24)+CHR(25)+" ANO º "+CHR(27)+CHR(26)+" MES º [ESC] SAI "
   SET CENTURY ON
   @ LIN,COL SAY PadC(TRIM(MES(DATAPARM))+" de "+STR(YEAR(DATAPARM),4),31)
   @ LIN+1,COL+1 SAY SEM
   @ LIN+9,COL+1 SAY AJU
   SET CENTURY OFF
   SETCOLOR(CNORM)
   @ LIN+2,COL+2 CLEAR TO LIN+8,COL+29
   DATACON=DATAPARM-(DAY(DATAPARM)-1)
   MES=MONTH(DATACON)
   LINX=LIN+3
   COLX=COL+3
   DO WHILE MONTH(DATACON)=MES
      POS=(DOW(DATACON)-1)*4
      IF DATACON#DATAHOJE
         @ LINX,COLX+POS SAY DAY(DATACON) PICT"99"
      ELSE
         SETCOLOR(CINVE)
         @ LINX,COLX+POS SAY DAY(DATACON) PICT"99"
         SETCOLOR(CNORM)
      ENDIF
      IF POS=24
         LINX=LINX+1
      ENDIF
      DATACON=DATACON+1
   ENDDO
   DO WHILE .T.
      SETCOLOR(CNORM)
      TECLA=INKEY(0)
      CLEAR TYPEAHEAD
      DO CASE
      CASE TECLA=27 && ESC
           RESTSCREEN(LIN,COL,LIN+10,COL+31,TELA)
           SETCOLOR(COR)
           RETURN(.T.)
      CASE TECLA=19 && <---
           DATACON=DATAPARM-(DAY(DATAPARM)-1)
           DATAPARM =DATACON-1
           EXIT
      CASE TECLA=04 && --->
           DATAPARM =DATACON+1
           EXIT
      CASE TECLA=24 &&  DOWN
           DATACON=CTOD("01/01/"+STRZERO(YEAR(DATAPARM),4))-1
           DATAPARM =CTOD("01/"+STRZERO(MONTH(DATAPARM),2)+"/"+STRZERO(YEAR(DATACON),4))
           EXIT
      CASE TECLA=5 &&  UP
           DATACON=CTOD("31/12/"+STRZERO(YEAR(DATAPARM),4))+1
           DATAPARM =CTOD("01/"+STRZERO(MONTH(DATAPARM),2)+"/"+STRZERO(YEAR(DATACON),4))
           EXIT
      ENDCASE
    ENDDO
ENDDO
*******************************
