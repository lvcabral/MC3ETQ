FUNCTION VALOR
PARAMETERS VALOR,TAMMAX,LINHAS

IF TYPE("LINHAS")#"A" .OR. LEN(LINHAS) < 3
   RETURN(.F.)
ENDIF
STORE STR(VALOR,12,2)   TO ED_TOTAL
STORE TRIM(ED_TOTAL)    TO ED_TOTAL
STORE LEN(ED_TOTAL)     TO AX_TMTOT

STOR SUBS(STR(1000000000000.00+VALOR,16,2),2,15) TO WVALEST

***** > rotina de impressao por extenso < *****

STORE "CENTO       DUZENTOS    TREZENTOS   QUATROCENTOSQUINHENTOS  ";
+ "SEISCENTOS  SETECENTOS  OITOCENTOS  NOVECENTOS  " TO ;
WCENTEN
STORE "VINTE    TRINTA   QUARENTA CINQUENTASESSENTA SETENTA  OITENTA";
+ "  NOVENTA " TO WDEZENA
STORE "DEZ      ONZE     DOZE     TREZE    QUATORZE QUINZE   DEZESSE";
+ "ISDEZESSETEDEZOITO  DEZENOVE " TO WDEZEN1
STORE "UM    DOIS  TRES  QUATROCINCO SEIS  SETE  OITO  NOVE  " TO ;
WUNIDA
STORE "(" TO WEXTENS
STORE 1 TO WCONMIL
STOR 0 TO WCHABIL,WCHAMLA,WCHAMIL
DO WHILE WCONMIL < 5
   STOR 0 TO WCHACEN,WCHADEZ,WCHADE1,WCHAUNI
   STORE (3 * WCONMIL) - 2 TO WPOSMIL
   IF SUBS(WVALEST,WPOSMIL,3) = "000"
      STORE 1 + WCONMIL TO WCONMIL
      LOOP
   ENDIF
   IF SUBS(WVALEST,WPOSMIL,3)="100"
      STOR WEXTENS + "CEM" TO WEXTENS
   ELSE
      STORE SUBS(WVALEST,WPOSMIL,3) TO WPOSIC
      STORE VAL(SUBS(WPOSIC,1,1)) TO WDIGITO
      IF WDIGITO <> 0
         STORE WEXTENS + TRIM(SUBS(WCENTEN,12 * WDIGITO - 11,12)) TO ;
         WEXTENS
         STORE 1 TO WCHACEN
      ENDIF
      STORE VAL(SUBS(WPOSIC,2,1)) TO WDIGITO
      IF WDIGITO <> 0
         IF WCHACEN = 1
            STORE WEXTENS + " E " TO WEXTENS
         ENDIF
         STORE 1 TO WCHADEZ
         IF WDIGITO = 1
            STORE VAL(SUBS(WPOSIC,3,1)) + 1 TO WDIGITO
            STORE WEXTENS + TRIM(SUBS(WDEZEN1, 9 * WDIGITO -8,9)) TO;
            WEXTENS
            STORE 1 TO WCHADE1
         ELSE
            STORE WEXTENS+TRIM(SUBS(WDEZENA,9*(WDIGITO-1)-8,9)) TO;
            WEXTENS
         ENDIF
      ENDIF
      STORE VAL(SUBS(WPOSIC,3,1)) TO WDIGITO
      IF WDIGITO <> 0 .AND. WCHADE1 = 0
         IF WCHACEN + WCHADEZ <> 0
            STORE WEXTENS + " E " TO WEXTENS
         ENDIF
         STORE WEXTENS + TRIM(SUBS(WUNIDA,6*WDIGITO-5,6)) TO WEXTENS
         STORE 1 TO WCHAUNI
      ENDIF
   ENDIF
   DO CASE
   CASE WCONMIL = 1
      IF SUBS(WVALEST,WPOSMIL,3) = "001"
         STORE WEXTENS + " BILHAO, " TO WEXTENS
      ELSE
         STORE WEXTENS + " BILHOES, " TO WEXTENS
      ENDIF
   CASE WCONMIL = 2
      IF SUBS(WVALEST,WPOSMIL,3) = "001"
         STORE WEXTENS + " MILHAO, " TO WEXTENS
      ELSE
         STORE WEXTENS + " MILHOES, " TO WEXTENS
      ENDIF
   CASE WCONMIL = 3
      IF (WCHABIL <> 0 .AND. WCHAMLA = 0) .OR. WCHAMLA <>0
         STORE WEXTENS + ", " TO WEXTENS
      ENDIF
      STORE 1 TO WCHAMIL
      STORE WEXTENS + " MIL, " TO WEXTENS
   ENDCASE
   STORE WCONMIL + 1 TO WCONMIL
ENDDO
STOR LEN(WEXTENS) TO WTAM
IF SUBS(WEXTENS,WTAM-1,1)=","
   STOR SUBS(WEXTENS,1,WTAM-2) TO WEXTENS
ENDIF
IF SUBS(WVALEST,7,6)="000000".and.VALOR>1
   STOR WEXTENS + " DE" TO WEXTENS
ENDIF
IF VALOR>=1
   STORE WEXTENS + IF(VALOR<2," CRUZEIRO"," CRUZEIROS") TO WEXTENS
ENDIF
STOR 0 TO WCHADE1
IF SUBS(WVALEST,14,2) = "00"
   STOR WEXTENS + ")" TO WEXTENS
ELSE
   IF VALOR>=1
      STOR WEXTENS + " E " TO WEXTENS
   ENDIF
   STOR SUBS(WVALEST,14,2) TO WPOSIC
   STOR VAL(SUBS(WPOSIC,1,1))  TO WDIGITO
   IF WDIGITO <> 0
      IF WDIGITO = 1
         STOR VAL(SUBS(WPOSIC,2,1))+1 TO WDIGITO
         STOR WEXTENS+TRIM(SUBS(WDEZEN1,9*WDIGITO-8,9)) TO WEXTENS
         STOR 1 TO WCHADE1
      ELSE
         STOR WEXTENS+TRIM(SUBS(WDEZENA,9*(WDIGITO-1)-8,9)) TO WEXTENS
      ENDIF
   ENDIF
   STOR VAL(SUBS(WPOSIC,2,1)) TO WDIGITO
   IF WDIGITO <> 0 .AND. WCHADE1 = 0
      IF VAL(WPOSIC)>9
         STOR WEXTENS+ " E " TO WEXTENS
      ENDIF
      STOR WEXTENS+TRIM(SUBS(WUNIDA,6*WDIGITO-5,6)) TO WEXTENS
   ENDIF
   STOR WEXTENS + IF(VAL(WPOSIC)<2," CENTAVO)"," CENTAVOS)") TO WEXTENS
ENDIF

***** > rotina de formatacao do valor por extenso < *****

AFILL(LINHAS,SPACE(TAMMAX))
STOR 1 TO CONTA
DO WHILE LEN(WEXTENS) > TAMMAX
   STORE SUBS(WEXTENS,1,TAMMAX) TO LINHA
   STORE LEN(WEXTENS) - LEN(LINHA) TO TAMRES
   STORE SUBS(WEXTENS,TAMMAX + 1,TAMRES) TO WEXTENS
   IF SUBS(LINHA, TAMMAX,1) <> " " .AND. SUBS(WEXTENS,1,1) = " "
      STOR LINHA TO LINHAS[CONTA]
   ELSE
      STORE TAMMAX TO I
      STORE 1 TO CONT
      DO WHILE SUBS(LINHA,I,1) <> " "
         STORE I - 1 TO I
         STORE CONT + 1 TO CONT
      ENDDO
      STORE SUBS(LINHA,I,CONT) TO TRANSPORTE
      STORE SUBS(LINHA,1,LEN(LINHA) - LEN(TRANSPORTE)) TO LINHA
      STORE TRANSPORTE + WEXTENS TO WEXTENS
      STORE TAMMAX - LEN(LINHA) TO BRANCOS
      DO WHILE BRANCOS > 0
         STORE 1 TO I
         DO WHILE LEN(LINHA) >= I .AND. BRANCOS > 0
            IF SUBS(LINHA,I,1) = " "
               STORE SUBS(LINHA,1,I)+" "+SUBS(LINHA,I+1,LEN(LINHA);
               - I + 1) TO LINHA
               STORE BRANCOS - 1 TO BRANCOS
               STORE I + 1 TO I
            ENDIF
            STORE I + 1 TO I
         ENDDO
      ENDDO
      STOR LINHA TO LINHAS[CONTA]
   ENDIF
   IF SUBS(WEXTENS,1,1) = " "
      STORE SUBS(WEXTENS,2,LEN(WEXTENS) - 1) TO WEXTENS
   ENDIF
   STOR CONTA+1 TO CONTA
ENDDO
STOR WEXTENS TO LINHAS[CONTA]
RETURN (.T.)
